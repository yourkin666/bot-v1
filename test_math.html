<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数学公式渲染测试</title>
    <script src="https://cdn.jsdelivr.net/npm/marked@12.0.0/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 2rem 0;
            padding: 1rem;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background-color: #f8fafc;
        }
        .markdown-content {
            background: white;
            padding: 1rem;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }
        /* 数学公式样式 */
        .markdown-content mjx-container {
            display: inline-block;
            margin: 0.3em 0.1em;
            color: #2d3748 !important;
        }
        .markdown-content mjx-container[display="block"] {
            display: block;
            text-align: center;
            margin: 1.5em 0;
            overflow-x: auto;
            overflow-y: visible;
            padding: 0.8em 0;
            background-color: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        .markdown-content mjx-container:not([display="block"]) {
            vertical-align: baseline;
            background-color: #f7fafc;
            padding: 2px 4px;
            border-radius: 3px;
            border: 1px solid #e2e8f0;
        }
    </style>
</head>
<body>
    <h1>数学公式渲染测试</h1>
    
    <div class="test-section">
        <h2>测试内容</h2>
        <p>以下是包含各种数学公式的测试内容：</p>
        <div id="test-content" class="markdown-content">
            <!-- 内容将通过JavaScript渲染 -->
        </div>
    </div>

    <script>
        // 配置MathJax
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                packages: {'[+]': ['ams', 'newcommand', 'autoload', 'color', 'physics', 'cancel', 'mathtools']},
                processEscapes: true,
                processEnvironments: true,
                tags: 'ams',
                processRefs: true,
                macros: {
                    RR: "{\\mathbb{R}}",
                    CC: "{\\mathbb{C}}",
                    NN: "{\\mathbb{N}}",
                    ZZ: "{\\mathbb{Z}}",
                    QQ: "{\\mathbb{Q}}",
                    vec: ["\\mathbf{#1}", 1],
                    norm: ["\\left\\|#1\\right\\|", 1]
                }
            },
            svg: {
                fontCache: 'global',
                scale: 1.2,
                minScale: 0.9,
                mtextInheritFont: true,
                displayAlign: 'center',
                displayIndent: '0'
            },
            options: {
                processHtmlClass: 'markdown-content',
                ignoreHtmlClass: 'tex2jax_ignore',
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
            },
            startup: {
                pageReady: () => {
                    console.log('MathJax页面准备就绪');
                    return MathJax.startup.defaultPageReady().then(() => {
                        console.log('MathJax初始化完成');
                        renderTestContent();
                    });
                }
            }
        };

        // 配置Marked.js
        marked.setOptions({
            breaks: true,
            gfm: true
        });

        // 测试内容
        const testMarkdown = `
# 数学公式测试

## 1. 行内数学公式
这是一个简单的行内公式：$E = mc^2$，还有一个复杂一点的：$\\int_{-\\infty}^{\\infty} e^{-x^2} dx = \\sqrt{\\pi}$

## 2. 块级数学公式
这是一个块级公式：

$$\\int_{-\\infty}^{\\infty} e^{-x^2} dx = \\sqrt{\\pi}$$

## 3. 复杂数学公式
矩阵表示：

$$\\begin{pmatrix}
a & b \\\\
c & d
\\end{pmatrix}$$

## 4. 分数和根号
分数：$\\frac{a}{b}$ 和根号：$\\sqrt{x^2 + y^2}$

复杂分数：
$$\\frac{\\partial f}{\\partial x} = \\lim_{h \\to 0} \\frac{f(x+h) - f(x)}{h}$$

## 5. 求和和积分
求和：$\\sum_{i=1}^{n} i = \\frac{n(n+1)}{2}$

积分：
$$\\int_0^1 x^2 dx = \\frac{1}{3}$$

## 6. 希腊字母和特殊符号
$\\alpha, \\beta, \\gamma, \\Delta, \\Omega$

$\\forall x \\in \\RR, \\exists y \\in \\NN$
        `;

        function renderTestContent() {
            console.log('开始渲染测试内容');
            const html = marked.parse(testMarkdown);
            const container = document.getElementById('test-content');
            container.innerHTML = html;
            
            // 渲染数学公式
            if (window.MathJax && window.MathJax.typesetPromise) {
                window.MathJax.typesetPromise([container]).then(() => {
                    console.log('数学公式渲染完成');
                }).catch((err) => {
                    console.error('数学公式渲染失败:', err);
                });
            }
        }
 