# 中文日期词汇处理功能

## 功能概述

这个功能可以自动将用户输入中的中文日期词汇（如"今日"、"昨日"、"明天"等）转换为具体的准确日期格式，帮助聊天机器人更好地理解和处理时间相关的查询。

## 支持的日期词汇

### 基本日期词汇

- **今天相关**: 今日、今天、今儿、今儿个
- **昨天相关**: 昨日、昨天、昨儿、昨儿个
- **明天相关**: 明日、明天、明儿、明儿个
- **前后天**: 前日、前天、后日、后天

### 周期性词汇

- **本周相关**: 本周、这周、这一周
- **上周相关**: 上周、上一周
- **下周相关**: 下周、下一周
- **本月相关**: 本月、这个月
- **上月相关**: 上月、上个月
- **下月相关**: 下月、下个月

### 相对时间表达

- **天数**: 3 天前、5 天后
- **周数**: 2 周前、1 周后
- **月数**: 1 个月前、3 个月后

### 星期词汇

- **短格式**: 周一、周二、周三、周四、周五、周六、周日
- **长格式**: 星期一、星期二、星期三、星期四、星期五、星期六、星期日

### 时间点词汇

- **现在相关**: 现在、此时、当前、目前

## 转换示例

| 原始输入         | 处理后输出                             |
| ---------------- | -------------------------------------- |
| 今天天气怎么样？ | 2025 年 06 月 19 日天气怎么样？        |
| 昨日的新闻       | 2025 年 06 月 18 日的新闻              |
| 明天有什么安排？ | 2025 年 06 月 20 日有什么安排？        |
| 本周的计划       | 本周(2025 年 06 月 19 日这一周)的计划  |
| 3 天前的报告     | 3 天前(2025 年 06 月 16 日)的报告      |
| 周一的会议       | 周一(本周 2025 年 06 月 16 日)的会议   |
| 现在是什么时间？ | 2025 年 06 月 19 日 11:55 是什么时间？ |

## 技术实现

### 处理流程

1. **相对时间处理**: 首先处理"3 天前"、"2 周后"等数字+时间单位的表达
2. **固定词汇映射**: 按照词汇长度从长到短排序处理，避免短词汇先匹配
3. **星期词汇处理**: 特别处理星期相关词汇，标明是本周还是上周/下周

### 关键特性

- **避免重复处理**: 已经处理过的词汇不会被重复替换
- **长词汇优先**: 优先匹配长词汇，避免"今儿个"只匹配到"今儿"的问题
- **时间上下文**: 星期词汇会标明是本周、上周还是下周的日期

## 使用方法

这个功能已经自动集成到聊天 API 中，用户发送的消息会在处理前自动进行日期词汇转换。

```python
# 在聊天API中自动调用
for message in messages:
    if message.get('role') == 'user' and message.get('text'):
        original_text = message['text']
        processed_text = preprocess_chinese_date_terms(original_text)
        if processed_text != original_text:
            message['text'] = processed_text
            logger.info(f"日期预处理: '{original_text}' -> '{processed_text}'")
```

## 注意事项

1. 所有日期转换都基于服务器当前时间
2. 月份计算使用近似值（30 天），不是精确的日历月份
3. 星期计算基于当前日期的星期几进行相对计算
4. 处理后的文本会保留原始词汇并在括号中添加具体日期信息

## 扩展性

如需添加新的日期词汇，只需在`simple_mappings`列表中添加新的映射关系即可。确保按照词汇长度排序以避免匹配冲突。
